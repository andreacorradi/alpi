<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Loading data from a CSV file</title>
		<script type="text/javascript" src="d3.min.js"></script>
		<style type="text/css">

			rect:hover {
				fill: orange;
			}

			#tooltip {
		        position: absolute;
		        width: 200px;
		        height: auto;
		        padding: 10px;
		        background-color: white;
		        -webkit-border-radius: 10px;
		        -moz-border-radius: 10px;
		        border-radius: 10px;
		        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
		        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
		        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
		        pointer-events: none;
			}

			#tooltip.hidden {
		        display: none;
			}

			#tooltip p {
		        margin: 0;
		        font-family: sans-serif;
		        font-size: 16px;
		        line-height: 20px;
			}

		</style>
	</head>
	<body>

		<div id="tooltip" class="hidden">
			<p><span id="name"></span></p>
		</div>

		<button id="but_height">height</button>
		<button id="but_lat">lat</button>
		<button id="but_firstascent">firstascent</button>	

		<script type="text/javascript">

			var w = 1200;
			var h = 500;

			var color = d3.scale.quantize()
                .range(["rgb(237,248,233)", "rgb(186,228,179)", "rgb(116,196,118)", "rgb(49,163,84)","rgb(0,109,44)"]);

			var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h);

			d3.csv("cime2500alpi_corretto.csv", function(dataset) {

				console.log(dataset);

				var xScale = d3.scale.ordinal()
                	.domain(d3.range(dataset.length))
                	.rangeRoundBands([0, w], 0.05);

               	var yScale = d3.scale.linear()
                .domain([0, d3.max(dataset, function(d) { return d.Height; })])
                .range([0, h-20]);

                color.domain(["AT", "AT/CH", "AT/DE", "AT/IT", "CH", "CH/FR", "CH/IT", "CH/LI", "DE", "FR", "FR/IT", "IT", "IT/SI", "SI"]);

                // bars
				svg.selectAll("rect")
				.data(dataset)
				.enter()
				.append("rect")
				.attr("x", function(d, i) {
					return xScale(i);
				})
				.attr("y", function(d) {
					return h - yScale(d.Height);
				})
				.attr("width", xScale.rangeBand())
				.attr("height", function(d) {
					return yScale(d.Height);
				})
				.attr("fill", function(d) {
    				//return "rgb(0, 0, " + (d.Drop/3) + ")";
    				var value = d.Country;
    				return color(value);
				})
			   	.on("mouseover", function(d) { //Get this bar's x/y values, then augment for the tooltip
					var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
					var yPosition = parseFloat(d3.select(this).attr("y")) / 2 + h / 2;

					//Update the tooltip position and value
					d3.select("#tooltip")
					  .style("left", xPosition + "px")
					  .style("top", yPosition + "px")
					  .select("#name")
					  .text(d.Mountain + ", " + d.Height + ", " + d.Drop + ", " + d.Firstascent + ", " + d.Lat);

					//Show the tooltip
					d3.select("#tooltip").classed("hidden", false);
				})
				.on("mouseout", function() { //Hide the tooltip
					d3.select("#tooltip").classed("hidden", true);
				});

				
				//PULSANTI
				d3.select("#but_lat")
					.on("click", function() {

						svg.selectAll("rect")
						   .sort(function(a, b) {
							   	return d3.ascending(a.Lat, b.Lat);	
						   	})
						   .transition()
						   .duration(1000)
						   .attr("x", function(d, i) {
						   		return xScale(i);
						   });

					});

				d3.select("#but_height")
					.on("click", function() {

						svg.selectAll("rect")
						   .sort(function(a, b) {
							   	return d3.descending(a.Height, b.Height);	
						   	})
						   .transition()
						   .duration(1000)
						   .attr("x", function(d, i) {
						   		return xScale(i);
						   });

					});

				d3.select("#but_firstascent")
					.on("click", function() {

						svg.selectAll("rect")
						   .sort(function(a, b) {
							   	return d3.ascending(a.Firstascent, b.Firstascent);	
						   	})
						   .transition()
						   .duration(1000)
						   .attr("x", function(d, i) {
						   		return xScale(i);
						   });

					});

			});

		</script>
	</body>
</html>